\section{Функциональное проектирование}
\label{sec:func}

\subsection{Класс \texttt{QTestPrinter}}
Класс \texttt{QTestPrinter} является реалиизацией блока тестирования специального принтера.
Данный класс выполняет поиск подлюченных принтеров, проверку правильности настроек принтера,
позволяет осуществить проверку состояния принтера путем печати тестовой страницы.

Класс \texttt{QTestPrinter} включает в себя следующие методы:

\begin{itemize}
	\item Метод \texttt{test} проводит процедуру тестирования принтера. Данный метод принимает ссылку на строку
		\texttt{sRez}. Данная строка служит для логгирования процесса тестирования устройства. Метод \texttt{test} производит
		проверку наличия принтера и корректности настроек его подкючения. В случае, если принтер подключен корректно, создается
		диалоговое окно для печати тестовой страницы. Для формирования тестовой страницы служит метод \texttt{print}, который
		связан с сигналом \texttt{paintRequested}. Сигнал \break\texttt{paintRequested} посылается при необходимости станартного
		класса Qt \texttt{QPrintPreviewDialog} сгенерировать изображения для предпросмотра печатаемых страниц. При положительном
		результате тестирования метод \texttt{test} возвращает 0, в противном случае возвращает код ошибки.

	\item Метод \texttt{print} осуществляет формирование тестовой страницы и настройку параметров печати. \texttt{print}
		принимает в качестве параметра указатель на класс \texttt{QPrintPreviewDialog}, который используется для настройки
		параметров печати.
\end{itemize}

\subsection{Класс \texttt{VTest\_BINS3}}
Данный класс отвечает за тестирование БИНС, работающей по протоколу БИНС-3.

Класс \texttt{VTest\_BINS3} имеет следующие методы и внутренние переменные:
\begin{itemize}
	\item Переменная \texttt{m\_bReceiveMess81} является флагом, который выставляется при получении сообщения
		статуса БИНС-3. Сообщение статуса имеет идентификатор 0x81.

	\item Переменная \texttt{m\_bReceiveMess01} - флаг, отвечающий за получения сообщения с навигационными данными.
		Данное Сообщение имеет идентификатор 0x01.

	\item Метод \texttt{onReadFromBins} принимает полученную с БИНС дейтаграмму в виде \texttt{QByteArray}.
		и осуществляет определение типа полученной команды. После определения типа команды устанваливается
		соотетствующий флаг.

	\item Метод \texttt{onReadFromSocket} выполняет чтение данных из сокета, через который идет общение с БИНС,
		метод вызывается при появлении информации для чтения с БИНС(сигнал \texttt{readyRead}).
		Данный метод принимает полученную с БИНС дейтаграмму в виде \texttt{QByteArray}.
		При считывании байт команды дейтаграмма передается в метод \texttt{onReadFromBins} для определения типа
		команды.

	\item Метод \texttt{test} является основным методом класса \texttt{VTest\_BINS3}. Данный метод отвечает
		непосредственно за управление тестированием\break БИНС. Метод проверяет подключение БИНС, настройки и
		параметры подключения устройства. При успешном получении сообщения с навигационными данными и сообщения
		статуса, программа передает управление функциям \texttt{decodeMes01} и \texttt{decodeMes81} для
		получения более подробных данных о состоянии устройства.

	\item Метод \texttt{decodeMes01} отвечает за анализ сообщений с навигационными данными. Метод принимает
		дейтаграмму \texttt{sRez} в качестве входного параметра. Метод позволяет получить
		различные навигационные данные(угол крена, угол тангажа, модуль скорости и т.п.), получить информацию об
		источниках координат, получить информацию о единицах измерения величин и системе координат, проверить
		достоверность полученных данных.

	\item Метод \texttt{decodeMes81} позволяет получить подробную информацию о состоянии системы. Метод принимает
		ссылку на флаг исправности устройства \texttt{bIspr} и ссылку на дейтаграмму \texttt{sRez}. Полученную
		информацию можно разделить на следующие категории:
		\begin{itemize}
				\item информация о состоянии ДПЦ;
				\item информация о доступных спутниках и наличии навигационного решения;
				\item информация о состоянии и исправности БИС-3;
				\item информация о состоянии INS;
				\item информация о наличии неисправностей в работе гироскопа и блока акселлерометров.
		\end{itemize}

	\item Метод \texttt{getCurrentTime} служит для получения текущего времени.

	\item Сигнал \texttt{getAllMessFromBINS} извещает о том, что уже получено и сообщение статуса, и сообщение с
		навигационными данными.. Данный сигнал посылается из функции \texttt{onReadFromBins} при наличии
		одновременно установленных флагов
		\texttt{m\_bReceiveMess01} и \texttt{m\_ReceiveMess81}. Данный сигнал используется в методе
		\texttt{test} при асинхронном ожидании окончания чтения из БИНС.

	\item Переменные \texttt{m\_mes01} и \texttt{m\_mes81} являются переменными типов \texttt{\_KDG\_01} и
		\texttt{\_KDG\_81} соответственно. Данные типа представляют собой структуры, описанные в заголовочном
		файле \texttt{Protocol\_BINS3.h}. Переменные данных типов инкапсулируют в себе дейтаграммы
		соответствующего формата. Переменные \texttt{m\_mes01} и \texttt{m\_mes81} используются в функциях
		\texttt{decodeMes01} и \texttt{decodeMes81} соответственно для удобного доступа к различным полям в
		заголовках дейтаграмм.
\end{itemize}

\subsection{Класс \texttt{VTest\_KNS2}}
Данный класс отвечает за тестирование КНС, работающей по протоколу КНС-2.

Класс \texttt{VTest\_KNS2} имеет следующие методы и внутренние переменные:
\begin{itemize}
	\item Переменная \texttt{m\_sockReceive} используется для создания UDP сокета, связанного с КНС.

	\item Флаг \texttt{m\_bSignValidTime} используется при проверке достоверности навигационных данных.

	\item Переменная \texttt{m\_timeGPS} служит для хранения времени, полученного из КНС.

	\item Переменная \texttt{m\_bReceiveMess66} является флагом, который выставляется при получении статусного
		сообщения КНС-2. Статусное сообщение имеет идентификатор 0x66.

	\item Переменная \texttt{m\_bReceiveMess01} - флаг, отвечающий за получения сообщения с навигационными данными.
		Данное Сообщение имеет идентификатор 0x01.

	\item Метод \texttt{onReadFromKNS} принимает полученную с КНС дейтаграмму в виде \texttt{QByteArray}.
		и осуществляет определение типа полученной команды. После определения типа команды устанваливается
		соотетствующий флаг.

	\item Метод \texttt{onReadFromSocket} выполняет чтение данных из сокета, через который идет общение с КНС,
		метод вызывается при появлении информации для чтения с КНС(сигнал \texttt{readyRead}).
		Данный метод принимает полученную с МНСТО дейтаграмму в виде \texttt{QByteArray}.
		При считывании байт команды дейтаграмма передается в метод \texttt{onReadFromKNS} для определения типа
		команды.

	\item Метод \texttt{test} является основным методом класса \texttt{VTest\_KNS2}. Данный метод отвечает
		непосредственно за управление тестированием\break КНС. Метод проверяет подключение КНС, настройки и
		параметры подключения устройства. Устройство может быть подключено как через COM порт, так и через
		сокетное соединение. В зависимости от типа подключения устройства необходимо использовать
		соответствующую реализацию метода. Метод инициирует устнаовление соединения с устройством и в случае
		успеха начинает обмен данными с КНС. При успешном получении сообщения с навигационными данными и сообщения
		статуса, программа передает управление функциям \texttt{decodeMes01} и \texttt{decodeMes66} для
		получения более подробных данных о состоянии устройства. При корректности полученных навигационных
		данных устанавливается флаг \texttt{m\_bSignValidTime} и происходит запись времени в переменную класса
		\texttt{m\_timeGPS}.

	\item Метод \texttt{decodeMes01} отвечает за анализ сообщений с навигационными данными. Метод принимает
		дейтаграмму \texttt{sRez} в качестве входного параметра. Метод позволяет получить
		различные навигационные данные(угол крена, угол тангажа, модуль скорости и т.п.), получить информацию о
		cостоянии устройства, получить информацию о исправности различных датчиков КНС, проверить достоверность
		полученной от датчиков информации.

	\item Метод \texttt{decodeMes66} позволяет получить подробную информацию о состоянии системы. Метод принимает
		ссылку на флаг исправности устройства \texttt{bIspr} и ссылку на дейтаграмму \texttt{sRez}. Данная
		дейтаграмма может предоставлять следующую информацию:
		\begin{itemize}
				\item время до завершения операции;
				\item идентификатор текущей операции;
				\item флаги исправности датчиков и подсистем КНС.
		\end{itemize}

	\item Метод \texttt{testByMulticast} позволяет провести проверку наличия КНС в мультикаст группе в случае
		общения с устройством через ЛВС.

	\item Метод \texttt{getCurrentTime} служит для получения текущего времени.

	\item Сигнал \texttt{getAllMessFromKNS} извещает о том, что уже получено и сообщение статуса. Данный сигнал
		посылается из функции\break \texttt{onReadFromKNS} при наличии
		устновленного флага
		\texttt{m\_bReceiveMess01}. Данный сигнал используется в методах
		\texttt{test} и \texttt{testByMulticast} при асинхронном ожидании окончания чтения из КНС.

	\item Переменные \texttt{m\_mes01} и \texttt{m\_mes66} являются переменными типов \texttt{\_KDG\_01} и
		\texttt{\_KDG\_66} соответственно. Данные типа представляют собой структуры, описанные в заголовочном
		файле \texttt{Protocol\_KNS2.h}. Переменные данных типов инкапсулируют в себе дейтаграммы
		соответствующего формата. Переменные \texttt{m\_mes01} и \texttt{m\_mes66} используются в функциях
		\texttt{decodeMes01} и \texttt{decodeMes66} соответственно для удобного доступа к различным полям в
		заголовках дейтаграмм.
\end{itemize}

\subsection{Класс \texttt{VTest\_MNSTO}}
Данный класс отвечает за тестирование МНСТО. МНСТО работает по соответствующему протоколу.

Класс \texttt{VTest\_MNSTO} имеет следующие методы и внутренние переменные:
\begin{itemize}
	\item Переменная \texttt{m\_sockReceive} используется для создания UDP сокета, связанного с МНСТО.

	\item Флаг \texttt{m\_bSignValidTime} используется при проверке достоверности навигационных данных.

	\item Переменная \texttt{m\_timeGPS} служит для хранения времени, полученного из МНСТО.

	\item Переменная \texttt{m\_bReceiveMess02} является флагом, который выставляется при получении сообщения с
		навигационными данными. Данное сообщение имеет идентификатор 0x02.

	\item Переменная \texttt{m\_bReceiveMess01} - флаг, отвечающий за получения сообщения с данными о состоянии
		устройства.
		Данное Сообщение имеет идентификатор 0x01.

	\item Метод \texttt{onReadFromKNS} принимает полученную с МНСТО дейтаграмму в виде \texttt{QByteArray}.
		и осуществляет определение типа полученной команды. После определения типа команды устанваливается
		соотетствующий флаг.

	\item Метод \texttt{onReadFromSocket} выполняет чтение данных из сокета, через который идет общение с МНСТО,
		метод вызывается при появлении информации для чтения с МНСТО(сигнал \texttt{readyRead}).
		Данный метод принимает полученную с МНСТО дейтаграмму в виде \texttt{QByteArray}.
		При считывании байт команды дейтаграмма передается в метод\break \texttt{onReadFromMNSTO} для определения типа
		команды.

	\item Метод \texttt{test} является основным методом класса \texttt{VTest\_MNSTO}. Данный метод отвечает
		непосредственно за управление тестированием\break КНС. Метод проверяет подключение МНСТО, настройки и
		параметры подключения устройства. Устройство может быть подключено как через COM порт, так и через
		сокетное соединение. В зависимости от типа подключения устройства необходимо использовать
		соответствующую реализацию метода. Метод инициирует устнаовление соединения с устройством и в случае
		успеха начинает обмен данными с МНСТО. При успешном получении сообщения с навигационными данными и сообщения
		статуса, программа передает управление функциям \texttt{decodeMes02} и \texttt{decodeMes01} для
		получения более подробных данных о состоянии устройства. При корректности полученных навигационных
		данных устанавливается флаг \texttt{m\_bSignValidTime} и происходит запись времени в переменную класса
		\texttt{m\_timeGPS}.

	\item Метод \texttt{decodeMes02} отвечает за анализ сообщений с навигационными данными. Метод принимает
		дейтаграмму \texttt{sRez} в качестве входного параметра. Метод позволяет получить
		различные навигационные данные(угол крена, длина пройденного пути, скорость и т.п.),
		проверить достоверность полученной от датчиков информации.

	\item Метод \texttt{decodeMes01} позволяет получить подробную информацию о состоянии системы. Метод принимает
		ссылку на дейтаграмму \texttt{sRez}. Данная
		дейтаграмма может предоставлять следующую информацию:
		\begin{itemize}
				\item состояние МНСТО;
				\item состояние БИН;
				\item сотояние БИС;
				\item состояние ДПЦ.
		\end{itemize}

	\item Метод \texttt{testByMulticast} позволяет провести проверку наличия МНСТО в мультикаст группе в случае
		общения с устройством через ЛВС.

	\item Метод \texttt{getCurrentTime} служит для получения текущего времени.

	\item Сигнал \texttt{getAllMessFromMNSTO} извещает о том, что уже получено и сообщение статуса. Данный сигнал
		посылается из функции\break \texttt{onReadFromMNSTO} при наличии
		устновленного флага\break
		\texttt{m\_bReceiveMess02}. Данный сигнал используется в методах
		\texttt{test} и\break \texttt{testByMulticast} при асинхронном ожидании окончания чтения из МНСТО.

	\item Переменные \texttt{m\_mes01} и \texttt{m\_mes02} являются переменными типов \texttt{\_KDG\_01} и
		\texttt{\_KDG\_02} соответственно. Данные типа представляют собой структуры, описанные в заголовочном
		файле \texttt{Protocol\_MNSTO.h}. Переменные данных типов инкапсулируют в себе дейтаграммы
		соответствующего формата. Переменные \texttt{m\_mes01} и \texttt{m\_mes02} используются в функциях
		\texttt{decodeMes01} и \texttt{decodeMes02} соответственно для удобного доступа к различным полям в
		заголовках дейтаграмм.
\end{itemize}
